---
layout: post
title: "IP, 7장 공간기반 처리 HPF"
description: "영상처리, 최경주교수님"
categories: [ImageProcessing]
tags: [2022-1, Image Processing, IP, 최경주]
use_math: true
redirect_from:
  - /IP/7
  - /blog/IP/7
---

* Kramdown table of contents
{:toc .toc} 

# Spatial Filtering : High-Pass Filter

> 신호 성분 중 고주파 성분은 통과시키고 저주파 성분은 차단          
> `에지 특징`을 검출하는 기능을 한다

- 첨예화 또는 샤프닝(sharpening)
  - 샤프닝은 기존 영상에 경계만 진해지는데,
  - 하이패스 필터는 기존 이미지에 경계만 남고 검정색이 됨
- 마스크 계수의 합은 0이기 때문에 일정하거나 서서히 변하는 밝기 영역에서 마스크 응답을 0에 가깝게 함
- 마스크가 중앙의 큰 양수 값과 주위의 작은 음수 값으로 되어 `경계선`을 더욱 두드러지게 함

Low pass Filter은 이웃점 내의 평균을 처리하며, 적분과 유사하지만

High pass Filter은 공간적 미분에 의해 이루어짐

디지털 공간에서 미분은 차에 의해 정의된다

- 에지 특징 추출
- 선명화 처리


@
\frac{1}{9} \times \begin{bmatrix}
-1 & -1 & -1 \\\ 
-1 & 8 & -1 \\\ 
-1 & -1 & -1 \\\ 
\end{bmatrix}
@

# edge 검출

> 물체의 경계는 변화량이 크다       
> 따라서 명암, 컬러, 텍스쳐의 변화량을 측정하고, 변화량이 큰 곳을 엣지로 검출한다

- step edge 
- ramp edge 

#### edge의 유용성

- 물체의 경계를 표시
- 영상 속에 어떤 물체가 있는지, 어떤 행위가 일어나는지의 정보를 유지
- 메모리가 적음
- 단계 처리에 적합함

#### edge의 한계

- 오검출, 미검출의 오류가 있음

#### edge 검출 과정

- 1차 미분에서 봉우리 또는 2차 미분에서 `영교차`를 찾음
- edge가 넓은 지역에 걸쳐 발생하므로 정확한 위치를 지정하는 위치찾기 방법이 필요함

## 1차 미분 연산자

디지털 공간에서의 미분은 -1 1 마스크로 가능하지만,

$
f'(x) = \frac{d f}{d x} = \frac{f(x + \triangle x) - f(x)}{\triangle x} = f(x+1) - f(x)
$

현실에서는 잡음 때문에 스무딩이 필요하다. 스무딩은 3*3 이상의 연산자를 사용하므로 $\delta x = 2$인 연산자로 확장

따라서 -1 0 1 마스크를 이용

$
f'(x) = \frac{d f}{d x} = \frac{f(x+1) - f(x-1)}{2}
$

2차원 영상에서는 두가지 마스크를 이용

$
\triangledown f = (\frac{\partial f}{\partial x}, \frac{\partial f}{\partial y}) = (f(x+1,y) - f(x-1,y), f(x,y+1) - f(x,y-1))
$

### The Gradient

이미지 12p

- 로버츠 연산자
  - 대칭도 아니고 크기도 작아 잘 이용하지 않음
- 프레윗 연산자
  - y방향의 미분값을 계산하는데 해당 행만 보는 것이 아니라, 그 아래와 윗 행까지 함께 고려한다 (스무딩)
- 소벨 연산자
  - 가까운 화소에 더 큰 가중치를 설정한다

#### edge 강도 및 방향

그레디언트 =
@
\triangledown f = (\frac{\partial f}{\partial x}, \frac{\partial f}{\partial y}) = (d_ x, d_ y)
@

edge 강도 : 화소 (x,y)가 edge일 가능성 또는 신뢰도
@
S(x, y) = magnitude(\triangledown f) = \sqrt{d_x ^ 2 + d_ y ^ 2}
@

edge 방향(edge direction) : 그레디언트 방향에 수직

@
D(x, y) = arctan(\frac{d_ y}{d_ x})
@

### Sobel Operator

마스크 검출 예

이미지 14

### edge Magnitude

> 에지 강도, 계산의 단순화를 위하여 다음과 같은 근사값을 사용

@
S(x,y) = magnitude(\bigtriangledown f) \approx  \|d_ x\| + \|d_ y \|
@

## 2차 미분 

> 1980, Marr와 Hildreth가 다중 스케일 엣지 검출 알고리즘 개발

`미분 전에 가우시안으로 먼저 스무딩함`

미분은 잡음을 증폭시키므로 스무딩 적용이 중요함        
따라서 잡음에 대처하기 위해 가우시안을 사용

또한 $\sigma$ 를 조절하여 다중 스케일 효과를 볼 수 있음

### The Laplacian

이미지 20

@
\triangledown^2 f = \frac{\partial^2 f}{\partial x^2} + \frac{\partial^2 f}{\partial y^2}
@

@
\frac{\partial^2 f}{\partial x^2} = f(x+1,y) + f(x-1,y)-2f(x,y) \\\ 
\frac{\partial^2 f}{\partial y^2} =  f(x,y+1) + f(x,y-1)-2f(x,y)
@

@
\triangledown^2 f =  f(x+1,y) + f(x-1,y) + f(x,y+1) + f(x,y-1) -4f(x,y)
@


- 계산 시간 과다
- 이산화에 따른 오류 누적


### LOG : Laplacian of Gaussian

`Marr-Hildreth의 edge 검출 알고리즘`

> 입력 영상에 가우시안 적용 -> 라플라시안 적용하는 것이 비효율적이다          
> 필터 하나로 한번에 처리

- 잡음 제거 : 가우시안
- 엣지 강조 : 라플라시안

@
\triangledown^2 (G(x,y) \bigotimes f(x,y) ) = (\triangledown^2 G(x,y)) \bigotimes f(x,y)
@

@
\triangledown^2 G(x,y) = (\frac{x^2+y^2-2\sigma}{\sigma^4})G(x,y)
@

#### LOG 필터의 특성

- 함수 자체에도 영교차가 나타남
- 방향과 무관한 등방성 성질
  - 등고선을 그려보면 중앙점을 중심으로 동심원이 형성됨
  - 사람의 시각도 비슷한 성질을 가짐이 증명됨
  - 따라서 Gradient를 사용한 edge 연산자보다 사람시각에 더 가깝다고 알려짐

#### Marr-Hildreth edge 검출 알고리즘

> 2차 미분에서 영교차 검출

1. $\sigma$ 크기의 가우시안으로 입력 영상 f를 스무딩한다.
2. 결과 영상에 라플라시안 영산자를 적용하여 2차 미분을 구한다.
3. 결과 영상에서 영교차를 찾아 에지로 설정하고 나머지는 비에지로 설정한다.

영교차 검출
1. 여덟개의 이웃 중에 마주보는 화소 쌍 네개를 조사한다. 그들 중 두개 이상이 서로 다른 부호를 가진다
2. 부호가 다른 쌍의 값 차이가 임계값을 넘는다



## Canny Edge 연산자

> 에지 검출을 최적화 문제로 해결함        
> 좋은 에지 알고리즘이 갖추어야 할 3가지 기준에 부합하는 목적함수를 만든 후, 최적화 하는 연산자를 설계

- 최소 오류율 : 오검출과 미검출이 최소여야 한다.
- 위치 정확도 : 검출된 에지는 시제 에지의 위치와 가급적 가까워야 한다.
- 에지 두께 : 실제 에지에 해당하는 곳에는 한 두께의 에지만 생성해야 한다.


1. 입력 영상에 $\sigma$ 크기의 가우시안 스무딩 적용
2. 결과 영상에 소벨 연산자를 적용하여 에지 강도와 에지 방향 맵 생성
3. 비최대 억제를 적용하여 얇은 두께 에지 맵 생성
4. 이력 임계값을 적용하여 거짓 긍정(오검출) 제거

이미지 32

#### 비최대 억제

- 특정 화소에 대해 자신의 두 이웃 화소보다 에지 강도가 크면 에지, 그렇지 않으면 억제
  - 억제 : 에지가 아닌 것으로 결정
- 비최대 억제를 위한 에지 방향 별 두 이웃 화소
- 지역최대점만 에지로 검출하므로 얇은 두께의 에지 영상 생성

#### 거짓 긍정(오검출)을 줄이는 방법

거짓 긍정 : 실제로는 에지가 아닌데 어떤 이유에 의해 에지로 판정된 경우

- 거짓 긍정을 없애는 가장 간단한 방법
  - 임계값 T 를 설정하고,
  - 에지 화소 p의 에지 강도 S(p) < T 이면 해당 화소를 거짓 긍정으로 보고 제거
- 길항(tradeoff) 작용 발생
  - T 를 높게 설정하면, 거짓 긍정 제거가 잘 되는 반면,
  - T 를 낮게 설정하면, 거짓 긍정이 그대로 남음.


#### 이력 임계값을 이용한 거짓 긍정 제거

- 2개의 임계값을 사용
- 에지 추적을 $T_ {high}$를 넘는 화소에서 시작, 추정 중에는 $T_ {low}$를 적용


## Laplacian을 이용한 영상의 선명화

> 원영상 + (A * 원영상 - 저주파 통과 필터 결과 영상)

`High-boost filtering`

원본 영상의 밝기를 증가한 후, 저주파 영상을 빼는 방식

- 고주역 통과 필터는 영상의 세부 정보를 강조하지만, 중요 부분인 낮은 공간 주파수 정보가 손실됨
- 고역증대 필터는 저주파 영역에서 손실한 양에 해당하는 일정량의 이득으 주어 손실으 보상받을 수 있음
