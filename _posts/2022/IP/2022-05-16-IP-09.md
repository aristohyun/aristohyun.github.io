---
layout: post
title: "IP, 9장 주파수 영역 기반 처리"
description: "영상처리, 최경주교수님"
categories: [ImageProcessing]
tags: [2022-1, Image Processing, IP, 최경주]
use_math: true
redirect_from:
  - /IP/9
  - /blog/IP/9
---

* Kramdown table of contents
{:toc .toc} 


# 공간 주파수의 이해

> 화소 밝기의 변화 등 주기적으로 재발생하는 빈도

- 저주파 공간 영역
  - 화소 밝기가 거의 변화가 없거나 점진적으로 변화하는 것
  - 영상에서 <blue>배경 부분</blue>이나 객체의 내부에 많이 있음
- 고주파 공간 영역
  - 화소 밝기가 급변하는 것
  - 경계부분이나 <blue>객체의 모서리</blue> 부분


공간 영역에서는 저주파 성분과 고주파 성분이 혼합되어 있음

따라서 영역을 분리해서 선별적으로 처리하기 어려우므로 `변환 영역 처리`가 필요함

> 주기를 가진 신호는 정현파, 여현파의 합으로 표현할 수 있다

정현파/여현파
- 모든 파형 중에 가장 순수한 파형
- 사인 또는 코사인 함수로 이루어져있음

> 실세계의 아무리 복잡한 파형도 주파수로 변환할 수 있다

`퓨리에 변환`

# 퓨리에 변환 

`Fourier Transform`

> 모든 주기적인 신호는 사인과 코사인의 합으로 표현할 수 있다

- 기저함수
  - $g_ u (x) = cos(2\pi u x) + j \cdot sin(2 \pi u x) = e^{j2\pi u x}$
- 퓨리에 변환 : 원본 신호로부터 계수 G(f)를 얻는 것 
  - $F(u) = \int_{- \infty }^{\infty} f(x) \cdot  e^{-j2\pi u x} dx$
- 퓨리에 역변환 : 기저함수로부터 원본신호를 만드는 것
  - $g(x) = \int_{- \infty }^{\infty} F(u) \cdot  e^{-j2\pi u x} du$


## 1차원 이산 퓨리에 변환

`Discrete Fourier Transform`

> 디지털 신호에 적용하는 퓨리에 변환

- f(x)는 디지털 신호, F(x)는 주파수 u에 대한 퓨리에 변환 계수
- u와 x는 신호의 원소 개수 (유한개)

@
F(u) = \sum \limits_ {x=0}^{M-1} f(x) \cdot e^{-j 2 \pi u \frac{x}{M}}
@

#### 1차원 이산 퓨리에 역변환, IDFT

@
f(x) = \frac{1}{M} \sum \limits_ {x=0}^{M-1} F(u) \cdot e^{-j 2 \pi u \frac{x}{M}}
@

## 2차원 이산 퓨리에 변환

> M x N 영상, f(x, y)      
> F(u,v) 값이 퓨리에 계수

@
F(u,v) =\sum \limits_ {x=0}^{M-1} \sum \limits_ {y=0}^{N-1} f(x,y) \cdot e^{-j 2 \pi (u \frac{x}{M} + v \frac{y}{N})}
@

#### 2차원 이산 퓨리에 역변환

@
f(x,y) = \frac{1}{MN} \sum \limits_ {u=0}^{M-1} \sum \limits_ {v=0}^{N-1} F(u,v) \cdot e^{-j 2 \pi (u \frac{x}{M} + v \frac{y}{N})}
@

### 변환

f(x,y) : 실수 -> F(u,v) : 복소수(일반적으로)

F(u,v)= Re(u,v) + Im(u,v)

> 복소수 행렬을 확인하기 위해 영상으로 표현

- 복소수의 실수부와 허수부를 벡터로 간주하여 벡터의 크기 계산 -> <red>주파수 스펙트럼</red>(퓨리에 스펙트럼)
- 실수부와 허수부 원소의 기울기 계산 -> <red>주파수의 위상</red>

@
\| F(u,v) \| = \sqrt{Re(u,v)^2 + Im(u,v)^2} \\\ 
\O(u,v) = tan^{-1} \left [  \frac{Im(u,v)}{Re(u,v)}  \right ]
@

> `주파수 도메인`이란, u와 v가 주파수 변수로 하는 F(u,v)가 점유하는 좌표 시스템        
> M x N 직사각형 영역을 `주파수 직사각형`이라고 부른다

### 주파수 스펙트럼 영상

> 계수값을 정규화해서 영상으로 표현하면     
> 최 저주파 영역은 흰색으로 나타나고,       
> 나머지 영역은 거의 검은색으로 나타난다

계수 값에 로그함수 적용 `로그 적용 정규화`

@
L(u,v) = c log\[ 1 + \| F(u,v) \| \]
@

> 저주파 영역이 모서리 부분에 위치, 고주파 부분이 중심부에 위치           

사각형의 각 모서리를 중심으로 원형의 밴드를 형성하여 주파수 영역이 분포됨

따라서 해당 주파수 영역 처리시 모양 변경이 필요험

이미지 14

### 주기성과 원점이동

이산적인 퓨리에 변환은 0 ~ M-1 간격에 있는 u 값에 대해 공식화 했으므로, 이 공식화 결과는 간격을 기준으로 등을 맞대고 있는 2개의 반주기가 생기게 됨

완전한 한 주기를 표시하기 위해서는 원점을 u = M/2로 이동해야 함

이미지 15

이를 이용해 이미지 중심이 최저주파 영역 바같쪽을 고주파 영역으로 바꿀 수 있음 `셔플링`

-> 원형 밴드로 주파수 영역을 쉽게 구분 가능함

이미지 16


# 퓨리에 변환을 이용한 주파수 영역에서의 필터링

> 저주파 영역과 고주파 영역을 분리한다면, 특정 주파수 영역 강화, 약화, 제거가 가능함

주파수 영역 필터링 과정

이미지 23

- 저주파 통과 필터링
  - DFT 변환 영역에서 저주파 영역의 계수들은 통과, 고주파 영역의 계수 차단
- 고주파 통과 필터링
  - 고주파 영역의 계수들은 통과시키고 저주파 영역의 계수들 차단

## Ideal Filter

이미지 26

### 저주파 통과 필터

> 원점 F(M/2, N/2)로부터 거리 D(u,v)가 차단주파수 $D_ 0$내의 저주파 성분은 1로 곱해 통과시키고,            
> 거리 밖의 고주파 성분은 0을 곱해 차단

 $D_ 0$는 필터의 반경이며 차단 주파수


### 고주파 통과 필터

> 원점 F(M/2, N/2)로부터 거리 D(u,v)가 차단주파수 $D_ 0$내의 저주파 성분은 0을 곱해 차단시키고,            
> 거리 밖의 고주파 성분은 1을 곱해 통과 시킴

### 문제점

- 특정한 대역에서 급격하게 값을 제거하기 때문에 결과 영상의 화질이 저하됨
- 객체의 경계 부분 주위로 잔물결 같은 무늬가 나타남

#### 해결 방법

- 필터 원소값을 차단 주파수에서 급격하게 0을 곱하지 않고, 완만한 경사를 이루도록 구성함
- 버터워즈 필터나 가우시안 필터 적용

### 버터워즈 필터

> 울림 현상을 없애기 위해 필터의 전달함수 D(u,v)를 연속적으로 완만하게 감소시키는 필터를 사용

매개변수 n은 경계선을 중심으로 D(u,v)의 값이 완만하게 변화하게 할 것인지 급격하게 변환하게 할 것인지를 조절함

- 저주파 통과 필터
  - $H(u,v) = \frac{1}{1 + \[ D(u,v) / D_ 0 \] ^ {2n} }$
- 고주파 통과 필터
  - $H(u,v) = \frac{1}{1 + \[ D_ 0 / D(u,v) \] ^ {2n}}$


### 가우시안 필터

> 가우시안의 퓨리에 역변환 역시 가우시안임     
> 따라서 ringing이 없음

- 저주파 통과 필터
  - $H(u,v) = e^{-D^2 (u,v) / 2 \sigma^2}$
  - $H(u,v) = e^{-D(u,v)/2D^2_ 0}$
  - $D_ 0$가 크면 함수의 폭이 넓어지므로 많은 저주파가 통과하게 되어 원 영상과 가까운 결과 영상이 만들어진다
- 고주파 통과 필터
  - $H(u,v) = 1 - e^{-D^2(u,v)/2D^2_ 0}$


### 선택적 필터링 : 노치 필터

> 중심 주파수 근처의 미리 정의된 이웃의 주파수들을 차단/통과 시킴

의미있는 결과를 얻기 위해서는 원점에 대해 대칭 쌍으로 나타나야 한다 : 퓨리에 변화의 대칭성 때문